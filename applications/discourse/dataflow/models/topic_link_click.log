SET IRMethod, name = create_from instanceMethod = false
BB 1
	outgoing: 82 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVECONSTARG def_args 
		 6: args[2.5,] 
BB 3
	outgoing: 4 
	datadep: 
	instructions:
		 0: HASH- def_%v_3 
		 1: COPY TYPE_PASS def_args %v_3[3.0,] 
BB 4
	outgoing: 5 6 
	datadep: 
	instructions:
		 0: 
		 1: args->[] def_%v_4 args[3.1,2.5,] 	 SYMBOL:url,	 ARGS:Symbol,
		 2: (TopicLink) def_%v_6 
		 3: %v_6->max_url_length def_%v_7 %v_6[4.2,] 	 SYMBOL:	 ARGS:
		 4: CONSTANT def_%v_5 %v_7[4.3,] 
		 5: %v_4->[] def_%v_8 %v_4[4.1,] %v_5[4.4,] 	 SYMBOL:	 ARGS:%v_5,
		 6: COPY TYPE_PASS def_url %v_8[4.5,] 
		 7: 
		 8: %v_8->blank? def_%v_9 %v_8[4.5,] 	 SYMBOL:	 ARGS:
		 9: BRANCH %v_9[4.8,] 
BB 5
	outgoing: 82 
	datadep: 
	instructions:
		 0: RETURN %self[2.0,] 
BB 6
	outgoing: 8 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_10 
		 1: 
		 2: GLOBALVAR $! def_%v_11 
BB 8
	outgoing: 10 11 
	datadep: 
	instructions:
		 0: 
		 1: (URI) def_%v_14 
		 2: %v_14->parse def_%v_15 %v_14[8.1,] url[4.6,] 	 SYMBOL:	 ARGS:url,
		 3: COPY TYPE_PASS def_%v_13 %v_15[8.2,] 
		 4: 
		 5: %v_11[6.2,] 
BB 10
	outgoing: 16 
	datadep: 
	instructions:
		 0: 
BB 11
	outgoing: 12 13 15 
	datadep: 
	instructions:
		 0: 
		 1: def_%v_16 
		 2: def_%v_17 %v_16[11.1,] 
		 3: BRANCH %v_17[11.2,] 
BB 12
	outgoing: 15 82 
	datadep: 
	instructions:
		 0: %v_16[11.1,] 
BB 13
	outgoing: 14 15 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_13 
		 1: 
		 2: %v_11[6.2,] 
BB 14
	outgoing: 16 
	datadep: 
	instructions:
		 0: 
BB 15
	outgoing: 82 
	datadep: 
	instructions:
		 0: def_%v_18 
		 1: def_%v_19 %v_18[15.0,] %v_11[6.2,] 
		 2: %v_18[15.0,] 
BB 16
	outgoing: 17 18 
	datadep: 
	instructions:
		 0: COPY TYPE_PASS def_uri %v_13[8.3,13.0,] 
		 1: 
		 2: (Set) def_%v_20 
		 3: %v_20->new def_%v_21 %v_20[16.2,] 	 SYMBOL:	 ARGS:
		 4: COPY TYPE_PASS def_urls %v_21[16.3,] 
		 5: 
		 6: %v_21-><< def_%v_22 %v_21[16.3,] url[4.6,] 	 SYMBOL:	 ARGS:url,
		 7: 
		 8: COPY TYPE_Regexp def_%v_23 
		 9: url->=~ def_%v_24 url[4.6,] 	 SYMBOL:	 ARGS:%v_23,
		 10: BRANCH %v_24[16.9,] 
BB 17
	outgoing: 19 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_Regexp def_%v_25 
		 2: COPY TYPE_StringLiteral "http" def_%v_26 
		 3: url->sub def_%v_27 url[4.6,] %v_26[17.2,] 	 SYMBOL:	 ARGS:%v_25,%v_26,
		 4: urls-><< def_%v_28 urls[16.4,] %v_27[17.3,] 	 SYMBOL:	 ARGS:%v_27,
		 5: 
		 6: COPY TYPE_Regexp def_%v_29 
		 7: COPY TYPE_StringLiteral "https:" def_%v_30 
		 8: url->sub def_%v_31 url[17.3,4.6,] %v_30[17.7,] 	 SYMBOL:	 ARGS:%v_29,%v_30,
		 9: urls-><< def_%v_32 urls[17.4,16.4,] %v_31[17.8,] 	 SYMBOL:	 ARGS:%v_31,
		 10: 
		 11: (UrlHelper) def_%v_33 
		 12: %v_33->schemaless def_%v_34 %v_33[17.11,] url[17.3,17.8,4.6,] 	 SYMBOL:	 ARGS:url,
		 13: urls-><< def_%v_35 urls[17.4,17.9,16.4,] %v_34[17.12,] 	 SYMBOL:	 ARGS:%v_34,
		 14: 
BB 18
	outgoing: 19 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_35 
BB 19
	outgoing: 20 21 
	datadep: 
	instructions:
		 0: 
		 1: (UrlHelper) def_%v_36 
		 2: %v_36->absolute_without_cdn def_%v_37 %v_36[19.1,] url[4.6,] 	 SYMBOL:	 ARGS:url,
		 3: urls-><< def_%v_38 urls[16.4,] %v_37[19.2,] 	 SYMBOL:	 ARGS:%v_37,
		 4: 
		 5: uri->try def_%v_39 uri[16.0,] 	 SYMBOL:host,	 ARGS:Symbol,
		 6: (Discourse) def_%v_40 
		 7: %v_40->current_hostname def_%v_41 %v_40[19.6,] 	 SYMBOL:	 ARGS:
		 8: %v_39->== def_%v_42 %v_39[19.5,] %v_41[19.7,] 	 SYMBOL:	 ARGS:%v_41,
		 9: BRANCH %v_42[19.8,] 
BB 20
	outgoing: 22 
	datadep: 
	instructions:
		 0: uri->path def_%v_43 uri[16.0,] 	 SYMBOL:	 ARGS:
		 1: urls-><< def_%v_44 urls[16.4,] %v_43[20.0,] 	 SYMBOL:	 ARGS:%v_43,
		 2: 
BB 21
	outgoing: 22 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_44 
BB 22
	outgoing: 23 24 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_StringLiteral "?" def_%v_45 
		 2: url->include? def_%v_46 url[4.6,] %v_45[22.1,] 	 SYMBOL:	 ARGS:%v_45,
		 3: BRANCH %v_46[22.2,] 
BB 23
	outgoing: 25 
	datadep: 
	instructions:
		 0: COPY TYPE_Regexp def_%v_47 
		 1: COPY TYPE_StringLiteral "" def_%v_48 
		 2: url->sub def_%v_49 url[4.6,] %v_48[23.1,] 	 SYMBOL:	 ARGS:%v_47,%v_48,
		 3: urls-><< def_%v_50 urls[16.4,] %v_49[23.2,] 	 SYMBOL:	 ARGS:%v_49,
		 4: 
BB 24
	outgoing: 25 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_50 
BB 25
	outgoing: 26 27 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_PASS def_%v_51 uri[16.0,] 
		 2: BRANCH uri[16.0,] 
BB 26
	outgoing: 27 
	datadep: 
	instructions:
		 0: (Discourse) def_%v_52 
		 1: %v_52->asset_host def_%v_53 %v_52[26.0,] 	 SYMBOL:	 ARGS:
		 2: %v_53->present? def_%v_54 %v_53[26.1,] 	 SYMBOL:	 ARGS:
		 3: COPY TYPE_PASS def_%v_51 %v_54[26.2,] 
BB 27
	outgoing: 28 45 
	datadep: 
	instructions:
		 0: BRANCH %v_51[26.3,25.1,] 
BB 28
	outgoing: 30 
	datadep: 
	instructions:
		 0: 
		 1: GLOBALVAR $! def_%v_55 
BB 30
	outgoing: 31 32 
	datadep: 
	instructions:
		 0: 
		 1: (URI) def_%v_58 
		 2: (Discourse) def_%v_59 
		 3: %v_59->asset_host def_%v_60 %v_59[30.2,] 	 SYMBOL:	 ARGS:
		 4: %v_58->parse def_%v_61 %v_58[30.1,] %v_60[30.3,] 	 SYMBOL:	 ARGS:%v_60,
		 5: COPY TYPE_PASS def_%v_57 %v_61[30.4,] 
		 6: 
		 7: %v_55[28.1,] 
BB 31
	outgoing: 37 
	datadep: 
	instructions:
		 0: 
BB 32
	outgoing: 33 34 36 
	datadep: 
	instructions:
		 0: 
		 1: def_%v_62 
		 2: def_%v_63 %v_62[32.1,] 
		 3: BRANCH %v_63[32.2,] 
BB 33
	outgoing: 36 82 
	datadep: 
	instructions:
		 0: %v_62[32.1,] 
BB 34
	outgoing: 35 36 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_57 
		 1: 
		 2: %v_55[28.1,] 
BB 35
	outgoing: 37 
	datadep: 
	instructions:
		 0: 
BB 36
	outgoing: 82 
	datadep: 
	instructions:
		 0: def_%v_64 
		 1: def_%v_65 %v_64[36.0,] %v_55[28.1,] 
		 2: %v_64[36.0,] 
BB 37
	outgoing: 38 39 
	datadep: 
	instructions:
		 0: COPY TYPE_PASS def_cdn_uri %v_57[30.5,34.0,] 
		 1: 
		 2: COPY TYPE_PASS def_%v_66 %v_57[30.5,34.0,] 
		 3: BRANCH %v_57[30.5,34.0,] 
BB 38
	outgoing: 39 
	datadep: 
	instructions:
		 0: cdn_uri->hostname def_%v_67 cdn_uri[37.0,] 	 SYMBOL:	 ARGS:
		 1: uri->hostname def_%v_68 uri[16.0,] 	 SYMBOL:	 ARGS:
		 2: %v_67->== def_%v_69 %v_67[38.0,] %v_68[38.1,] 	 SYMBOL:	 ARGS:%v_68,
		 3: COPY TYPE_PASS def_%v_66 %v_69[38.2,] 
BB 39
	outgoing: 40 41 
	datadep: 
	instructions:
		 0: BRANCH %v_66[38.3,37.2,] 
BB 40
	outgoing: 41 
	datadep: 
	instructions:
		 0: uri->path def_%v_70 uri[16.0,] 	 SYMBOL:	 ARGS:
		 1: cdn_uri->path def_%v_71 cdn_uri[37.0,] 	 SYMBOL:	 ARGS:
		 2: %v_70->starts_with? def_%v_72 %v_70[40.0,] %v_71[40.1,] 	 SYMBOL:	 ARGS:%v_71,
		 3: COPY TYPE_PASS def_%v_66 %v_72[40.2,] 
BB 41
	outgoing: 42 43 
	datadep: 
	instructions:
		 0: BRANCH %v_66[40.3,38.3,37.2,] 
BB 42
	outgoing: 44 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_Boolean def_is_cdn_link 
		 2: 
		 3: uri->path def_%v_73 uri[16.0,] 	 SYMBOL:	 ARGS:
		 4: cdn_uri->path def_%v_75 cdn_uri[37.0,] 	 SYMBOL:	 ARGS:
		 5: %v_75->length def_%v_76 %v_75[42.4,] 	 SYMBOL:	 ARGS:
		 6: CONSTANT def_%v_74 %v_76[42.5,] 
		 7: %v_73->[] def_%v_77 %v_73[42.3,] %v_74[42.6,] 	 SYMBOL:	 ARGS:%v_74,
		 8: urls-><< def_%v_78 urls[16.4,] %v_77[42.7,] 	 SYMBOL:	 ARGS:%v_77,
		 9: 
BB 43
	outgoing: 44 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_78 
BB 44
	outgoing: 46 
	datadep: 
	instructions:
		 0: 
BB 45
	outgoing: 46 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_78 
BB 46
	outgoing: 47 48 
	datadep: 
	instructions:
		 0: 
		 1: (TopicLink) def_%v_79 
		 2: COPY TYPE_Array def_%v_80 
		 3: %v_79->select def_%v_81 %v_79[46.1,] %v_80[46.2,] 	 SYMBOL:	 ARGS:%v_80,
		 4: COPY TYPE_PASS def_link %v_81[46.3,] 
		 5: 
		 6: (Array) def_%v_82 
		 7: urls->count def_%v_83 urls[16.4,] 	 SYMBOL:	 ARGS:
		 8: COPY TYPE_StringLiteral "url = ?" def_%v_84 
		 9: %v_82->new def_%v_85 %v_82[46.6,] %v_83[46.7,] %v_84[46.8,] 	 SYMBOL:	 ARGS:%v_83,%v_84,
		 10: COPY TYPE_StringLiteral " OR " def_%v_86 
		 11: %v_85->join def_%v_87 %v_85[46.9,] %v_86[46.10,] 	 SYMBOL:	 ARGS:%v_86,
		 12: COPY TYPE_Array def_%v_88 %v_87[46.11,] 
		 13: def_%v_89 %v_88[46.12,] urls[46.7,16.4,] 
		 14: link->where def_%v_90 link[46.4,] %v_89[46.13,] 	 SYMBOL:	 ARGS:Splat,
		 15: COPY TYPE_PASS def_link %v_90[46.14,] 
		 16: 
		 17: args->[] def_%v_91 args[3.1,2.5,] 	 SYMBOL:post_id,	 ARGS:Symbol,
		 18: %v_91->present? def_%v_92 %v_91[46.17,] 	 SYMBOL:	 ARGS:
		 19: BRANCH %v_92[46.18,] 
BB 47
	outgoing: 49 
	datadep: 
	instructions:
		 0: args->[] def_%v_93 args[3.1,2.5,] 	 SYMBOL:post_id,	 ARGS:Symbol,
		 1: HASH-post_id- def_%v_94 %v_93[47.0,] 
		 2: link->where def_%v_95 link[46.4,46.15,] %v_94[47.1,] 	 SYMBOL:	 ARGS:%v_94,
		 3: COPY TYPE_PASS def_link %v_95[47.2,] 
		 4: 
BB 48
	outgoing: 49 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_95 
BB 49
	outgoing: 50 51 
	datadep: 
	instructions:
		 0: 
		 1: args->[] def_%v_96 args[3.1,2.5,] 	 SYMBOL:topic_id,	 ARGS:Symbol,
		 2: %v_96->present? def_%v_97 %v_96[49.1,] 	 SYMBOL:	 ARGS:
		 3: BRANCH %v_97[49.2,] 
BB 50
	outgoing: 52 
	datadep: 
	instructions:
		 0: args->[] def_%v_98 args[3.1,2.5,] 	 SYMBOL:topic_id,	 ARGS:Symbol,
		 1: HASH-topic_id- def_%v_99 %v_98[50.0,] 
		 2: link->where def_%v_100 link[47.3,46.4,46.15,] %v_99[50.1,] 	 SYMBOL:	 ARGS:%v_99,
		 3: COPY TYPE_PASS def_link %v_100[50.2,] 
		 4: 
BB 51
	outgoing: 52 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_100 
BB 52
	outgoing: 53 54 
	datadep: 
	instructions:
		 0: 
		 1: link->first def_%v_101 link[50.3,47.3,46.4,46.15,] 	 SYMBOL:	 ARGS:
		 2: COPY TYPE_PASS def_link %v_101[52.1,] 
		 3: 
		 4: %v_101->present? def_%v_102 %v_101[52.1,] 	 SYMBOL:	 ARGS:
		 5: BRANCH %v_102[52.4,] 
BB 53
	outgoing: 72 73 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_103 
		 1: 
		 2: args->[] def_%v_122 args[3.1,2.5,] 	 SYMBOL:user_id,	 ARGS:Symbol,
		 3: BRANCH %v_122[53.2,] 
BB 54
	outgoing: 55 56 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_Regexp def_%v_104 
		 2: url->=~ def_%v_105 url[4.6,] 	 SYMBOL:	 ARGS:%v_104,
		 3: BRANCH %v_105[54.2,] 
BB 55
	outgoing: 56 
	datadep: 
	instructions:
		 0: uri->try def_%v_106 uri[16.0,] 	 SYMBOL:host,	 ARGS:Symbol,
		 1: (Discourse) def_%v_107 
		 2: %v_107->current_hostname def_%v_108 %v_107[55.1,] 	 SYMBOL:	 ARGS:
		 3: %v_106->== def_%v_109 %v_106[55.0,] %v_108[55.2,] 	 SYMBOL:	 ARGS:%v_108,
		 4: COPY TYPE_PASS def_%v_105 %v_109[55.3,] 
BB 56
	outgoing: 57 58 
	datadep: 
	instructions:
		 0: BRANCH %v_105[55.4,54.2,] 
BB 57
	outgoing: 82 
	datadep: 
	instructions:
		 0: RETURN url[4.6,] %self[2.0,] 
BB 58
	outgoing: 60 61 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_110 
		 1: 
		 2: (TopicLink) def_%v_111 
		 3: HASH-url- def_%v_112 url[4.6,] 
		 4: %v_111->find_by def_%v_113 %v_111[58.2,] %v_112[58.3,] 	 SYMBOL:	 ARGS:%v_112,
		 5: COPY TYPE_PASS def_link %v_113[58.4,] 
		 6: 
		 7: %v_113->present? def_%v_114 %v_113[58.4,] 	 SYMBOL:	 ARGS:
		 8: BRANCH %v_114[58.7,] 
BB 60
	outgoing: 82 
	datadep: 
	instructions:
		 0: link->url def_%v_115 link[58.5,] 	 SYMBOL:	 ARGS:
		 1: RETURN %v_115[60.0,] %self[2.0,] 
BB 61
	outgoing: 63 64 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_116 
		 1: 
		 2: BRANCH uri[16.0,] 
BB 63
	outgoing: 66 67 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_117 
		 1: 
		 2: (WHITELISTED_REDIRECT_HOSTNAMES) def_%v_118 
		 3: uri->hostname def_%v_119 uri[16.0,] 	 SYMBOL:	 ARGS:
		 4: %v_118->include? def_%v_120 %v_118[63.2,] %v_119[63.3,] 	 SYMBOL:	 ARGS:%v_119,
		 5: BRANCH %v_120[63.4,] 
BB 64
	outgoing: 82 
	datadep: 
	instructions:
		 0: RETURN %self[2.0,] 
BB 66
	outgoing: 67 
	datadep: 
	instructions:
		 0: COPY TYPE_PASS def_%v_120 is_cdn_link[42.1,] 
BB 67
	outgoing: 68 69 
	datadep: 
	instructions:
		 0: BRANCH %v_120[66.0,63.4,] 
BB 68
	outgoing: 82 
	datadep: 
	instructions:
		 0: RETURN url[4.6,] %self[2.0,] 
BB 69
	outgoing: 82 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_121 
		 1: 
		 2: RETURN %self[2.0,] 
BB 72
	outgoing: 73 
	datadep: 
	instructions:
		 0: link->user_id def_%v_123 link[52.2,] 	 SYMBOL:	 ARGS:
		 1: args->[] def_%v_124 args[3.1,2.5,] 	 SYMBOL:user_id,	 ARGS:Symbol,
		 2: %v_123->== def_%v_125 %v_123[72.0,] %v_124[72.1,] 	 SYMBOL:	 ARGS:%v_124,
		 3: COPY TYPE_PASS def_%v_122 %v_125[72.2,] 
BB 73
	outgoing: 74 75 
	datadep: 
	instructions:
		 0: BRANCH %v_122[72.3,53.2,] 
BB 74
	outgoing: 82 
	datadep: 
	instructions:
		 0: RETURN url[4.6,] %self[2.0,] 
BB 75
	outgoing: 77 78 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_126 
		 1: 
		 2: COPY TYPE_StringLiteral "link-clicks:" def_%v_127 
		 3: link->id def_%v_128 link[52.2,] 	 SYMBOL:	 ARGS:
		 4: COPY TYPE_StringLiteral ":" def_%v_129 
		 5: args->[] def_%v_130 args[3.1,2.5,] 	 SYMBOL:user_id,	 ARGS:Symbol,
		 6: BRANCH %v_130[75.5,] 
BB 77
	outgoing: 78 
	datadep: 
	instructions:
		 0: args->[] def_%v_131 args[3.1,2.5,] 	 SYMBOL:ip,	 ARGS:Symbol,
		 1: COPY TYPE_PASS def_%v_130 %v_131[77.0,] 
BB 78
	outgoing: 79 80 
	datadep: 
	instructions:
		 0: BUILDSTRING def_%v_132 %v_127[75.2,] %v_128[75.3,] %v_129[75.4,] %v_130[77.1,75.5,] 
		 1: COPY TYPE_PASS def_rate_key %v_132[78.0,] 
		 2: 
		 3: GLOBALVAR $redis def_%v_133 
		 4: COPY TYPE_StringLiteral "1" def_%v_134 
		 5: %v_133->setnx def_%v_135 %v_133[78.3,] %v_132[78.0,] %v_134[78.4,] 	 SYMBOL:	 ARGS:rate_key,%v_134,
		 6: BRANCH %v_135[78.5,] 
BB 79
	outgoing: 81 
	datadep: 
	instructions:
		 0: 
		 1: GLOBALVAR $redis def_%v_136 
		 2: CONSTANT def_%v_137 	 SYMBOL:	 ARGS:
		 3: %v_137->to_i def_%v_138 %v_137[79.2,] 	 SYMBOL:	 ARGS:
		 4: %v_136->expire def_%v_139 %v_136[79.1,] rate_key[78.1,] %v_138[79.3,] 	 SYMBOL:	 ARGS:rate_key,%v_138,
		 5: 
		 6: link->id def_%v_140 link[52.2,] 	 SYMBOL:	 ARGS:
		 7: args->[] def_%v_141 args[3.1,2.5,] 	 SYMBOL:user_id,	 ARGS:Symbol,
		 8: args->[] def_%v_142 args[79.7,3.1,2.5,] 	 SYMBOL:ip,	 ARGS:Symbol,
		 9: HASH-topic_link_id-user_id-ip_address- def_%v_143 %v_140[79.6,] %v_141[79.7,] %v_142[79.8,] 
		 10: %self->create! def_%v_144 %self[2.0,] %v_143[79.9,] 	 SYMBOL:	 ARGS:%v_143,
		 11: 
BB 80
	outgoing: 81 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_144 
BB 81
	outgoing: 82 
	datadep: 
	instructions:
		 0: 
		 1: RETURN url[4.6,] %self[2.0,] 
BB 82
	outgoing: 
	datadep: 
	instructions:

