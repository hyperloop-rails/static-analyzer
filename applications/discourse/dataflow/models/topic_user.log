SET IRMethod, name = notification_levels instanceMethod = true
BB 1
	outgoing: 7 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: 
		 6: def_%v_4 %self[2.0,] 
		 7: COPY TYPE_PASS def_%v_3 %v_4[2.6,] 
		 8: %v_4[2.6,] 
BB 3
	outgoing: 4 
	datadep: 
	instructions:
		 0: GETFIELD %self->notification_levels def_%v_5 %self[2.0,] 
		 1: COPY TYPE_PASS def_%v_3 %v_5[3.0,] 
BB 4
	outgoing: 5 6 
	datadep: 
	instructions:
		 0: BRANCH %v_3[3.1,2.7,] 
BB 5
	outgoing: 7 
	datadep: 
	instructions:
		 0: (Enum) def_%v_6 
		 1: HASH-muted-regular-tracking-watching- def_%v_7 
		 2: %v_6->new def_%v_8 %v_6[5.0,] %v_7[5.1,] 	 SYMBOL:	 ARGS:%v_7,
		 3: ATTRASSIGN %self->notification_levels %v_8[5.2,] 
		 4: RETURN %v_8[5.2,] %self[5.3,2.0,] 
BB 6
	outgoing: 7 
	datadep: 
	instructions:
		 0: RETURN %v_5[3.0,] %self[2.0,] 
BB 7
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = notification_reasons instanceMethod = true
BB 1
	outgoing: 7 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: 
		 6: def_%v_4 %self[2.0,] 
		 7: COPY TYPE_PASS def_%v_3 %v_4[2.6,] 
		 8: %v_4[2.6,] 
BB 3
	outgoing: 4 
	datadep: 
	instructions:
		 0: GETFIELD %self->notification_reasons def_%v_5 %self[2.0,] 
		 1: COPY TYPE_PASS def_%v_3 %v_5[3.0,] 
BB 4
	outgoing: 5 6 
	datadep: 
	instructions:
		 0: BRANCH %v_3[3.1,2.7,] 
BB 5
	outgoing: 7 
	datadep: 
	instructions:
		 0: (Enum) def_%v_6 
		 1: HASH-created_topic-user_changed-user_interacted-created_post-auto_watch-auto_watch_category-auto_mute_category-auto_track_category-plugin_changed- def_%v_7 
		 2: %v_6->new def_%v_8 %v_6[5.0,] %v_7[5.1,] 	 SYMBOL:	 ARGS:%v_7,
		 3: ATTRASSIGN %self->notification_reasons %v_8[5.2,] 
		 4: RETURN %v_8[5.2,] %self[5.3,2.0,] 
BB 6
	outgoing: 7 
	datadep: 
	instructions:
		 0: RETURN %v_5[3.0,] %self[2.0,] 
BB 7
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = auto_track instanceMethod = true
BB 1
	outgoing: 6 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_user_id 
		 6: RECEIVEARG def_topic_id 
		 7: RECEIVEARG def_reason 
		 8: 
		 9: (TopicUser) def_%v_3 
		 10: HASH-user_id-topic_id-notifications_reason_id- def_%v_4 user_id[2.5,] topic_id[2.6,] 
		 11: %v_3->where def_%v_5 %v_3[2.9,] %v_4[2.10,] 	 SYMBOL:	 ARGS:%v_4,
		 12: %v_5->exists? def_%v_6 %v_5[2.11,] 	 SYMBOL:	 ARGS:
		 13: BRANCH %v_6[2.12,] 
BB 3
	outgoing: 6 
	datadep: 
	instructions:
		 0: 
		 1: %self->notification_levels def_%v_7 %self[2.0,] 	 SYMBOL:	 ARGS:
		 2: %v_7->[] def_%v_8 %v_7[3.1,] 	 SYMBOL:tracking,	 ARGS:Symbol,
		 3: HASH-notification_level-notifications_reason_id- def_%v_9 %v_8[3.2,] reason[2.7,] 
		 4: %self->change def_%v_10 %self[3.1,2.0,] user_id[2.5,] topic_id[2.6,] %v_9[3.3,] 	 SYMBOL:	 ARGS:user_id,topic_id,%v_9,
		 5: 
		 6: (MessageBus) def_%v_11 
		 7: COPY TYPE_StringLiteral "/topic/" def_%v_12 
		 8: BUILDSTRING def_%v_13 %v_12[3.7,] topic_id[2.6,] 
		 9: %self->notification_levels def_%v_14 %self[3.1,3.4,2.0,] 	 SYMBOL:	 ARGS:
		 10: %v_14->[] def_%v_15 %v_14[3.9,] 	 SYMBOL:tracking,	 ARGS:Symbol,
		 11: HASH-notification_level_change-notifications_reason_id- def_%v_16 %v_15[3.10,] reason[2.7,] 
		 12: COPY TYPE_Array def_%v_17 user_id[2.5,] 
		 13: HASH-user_ids- def_%v_18 %v_17[3.12,] 
		 14: %v_11->publish def_%v_19 %v_11[3.6,] %v_13[3.8,] %v_16[3.11,] %v_18[3.13,] 	 SYMBOL:	 ARGS:%v_13,%v_16,%v_18,
		 15: RETURN %v_19[3.14,] %self[3.1,3.4,3.9,2.0,] 
BB 4
	outgoing: 6 
	datadep: 
	instructions:
		 0: RETURN %self[2.0,] 
BB 6
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = auto_watch instanceMethod = true
BB 1
	outgoing: 3 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_user_id 
		 6: RECEIVEARG def_topic_id 
		 7: 
		 8: (TopicUser) def_%v_3 
		 9: HASH-user_id-topic_id- def_%v_4 user_id[2.5,] topic_id[2.6,] 
		 10: %v_3->find_or_initialize_by def_%v_5 %v_3[2.8,] %v_4[2.9,] 	 SYMBOL:	 ARGS:%v_4,
		 11: COPY TYPE_PASS def_topic_user %v_5[2.10,] 
		 12: 
		 13: %self->notification_levels def_%v_6 %self[2.0,] 	 SYMBOL:	 ARGS:
		 14: %v_6->[] def_%v_7 %v_6[2.13,] 	 SYMBOL:watching,	 ARGS:Symbol,
		 15: ATTRASSIGN topic_user->notification_level %v_7[2.14,] 
		 16: 
		 17: %self->notification_reasons def_%v_8 %self[2.0,2.13,] 	 SYMBOL:	 ARGS:
		 18: %v_8->[] def_%v_9 %v_8[2.17,] 	 SYMBOL:auto_watch,	 ARGS:Symbol,
		 19: ATTRASSIGN topic_user->notifications_reason_id %v_9[2.18,] 
		 20: 
		 21: topic_user->save def_%v_10 topic_user[2.11,2.15,2.19,] 	 SYMBOL:	 ARGS:
		 22: RETURN %v_10[2.21,] %self[2.0,2.13,2.17,] 
BB 3
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = lookup_for instanceMethod = true
BB 1
	outgoing: 8 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_user 
		 6: RECEIVEARG def_topics 
		 7: 
		 8: user->blank? def_%v_3 user[2.5,] 	 SYMBOL:	 ARGS:
		 9: BRANCH %v_3[2.8,] 
BB 3
	outgoing: 4 
	datadep: 
	instructions:
		 0: topics->blank? def_%v_4 topics[2.6,] 	 SYMBOL:	 ARGS:
		 1: COPY TYPE_PASS def_%v_3 %v_4[3.0,] 
BB 4
	outgoing: 5 6 
	datadep: 
	instructions:
		 0: BRANCH %v_3[3.1,2.8,] 
BB 5
	outgoing: 8 
	datadep: 
	instructions:
		 0: HASH- def_%v_5 
		 1: RETURN %v_5[5.0,] %self[2.0,] 
BB 6
	outgoing: 8 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_6 
		 1: 
		 2: topics->map def_%v_7 topics[2.6,] 	 SYMBOL:id,	 ARGS:
		 3: COPY TYPE_PASS def_topic_ids %v_7[6.2,] 
		 4: 
		 5: (TopicUser) def_%v_8 
		 6: user->id def_%v_9 user[2.5,] 	 SYMBOL:	 ARGS:
		 7: HASH-topic_id-user_id- def_%v_10 topic_ids[6.3,] %v_9[6.6,] 
		 8: %v_8->where def_%v_11 %v_8[6.5,] %v_10[6.7,] 	 SYMBOL:	 ARGS:%v_10,
		 9: %self->create_lookup def_%v_12 %self[2.0,] %v_11[6.8,] 	 SYMBOL:	 ARGS:%v_11,
		 10: RETURN %v_12[6.9,] %self[6.9,2.0,] 
BB 8
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = create_lookup instanceMethod = true
BB 1
	outgoing: 6 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_topic_users 
		 6: 
		 7: topic_users->to_a def_%v_3 topic_users[2.5,] 	 SYMBOL:	 ARGS:
		 8: COPY TYPE_PASS def_topic_users %v_3[2.7,] 
		 9: 
		 10: HASH- def_%v_4 
		 11: COPY TYPE_PASS def_result %v_4[2.10,] 
		 12: 
		 13: %v_3->blank? def_%v_5 %v_3[2.7,] 	 SYMBOL:	 ARGS:
		 14: BRANCH %v_5[2.13,] 
BB 3
	outgoing: 6 
	datadep: 
	instructions:
		 0: RETURN result[2.11,] %self[2.0,] 
BB 4
	outgoing: 6 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_6 
		 1: 
		 2: topic_users->each def_%v_7 topic_users[2.5,2.8,] %self[2.0,] 	 SYMBOL:	 ARGS:topic_users,
CLOSURE BEGIN: ftu[] result[2.11,] 
BB 1
	outgoing: 6 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%cl_1_0 
		 2: RECEIVEARG def_ftu 
		 3: COPY TYPE_CurrentScope def_%current_scope 
		 4: COPY TYPE_ScopeModule def_%current_module 
BB 3
	outgoing: 4 6 
	datadep: 
	instructions:
		 0: 
		 1: ftu->topic_id def_%cl_1_3 ftu[2.2,] 	 SYMBOL:	 ARGS:
		 2: ATTRASSIGN result->[] %cl_1_3[3.1,] ftu[3.1,2.2,] 
		 3: RETURN ftu[3.1,2.2,] %self[2.0,] 
BB 4
	outgoing: 6 
	datadep: 
	instructions:
		 0: def_%cl_1_4 
		 1: def_%cl_1_5 %cl_1_4[4.0,] 
		 2: RETURN %cl_1_5[4.1,] %self[2.0,] 
BB 6
	outgoing: 
	datadep: 
	instructions:
CLOSURE END: 
		 3: 
		 4: RETURN result[2.11,] %self[2.0,] 
BB 6
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = get instanceMethod = true
BB 1
	outgoing: 9 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_topic 
		 6: RECEIVEARG def_user 
		 7: 
		 8: (Topic) def_%v_3 
		 9: topic->is_a? def_%v_4 topic[2.5,] %v_3[2.8,] 	 SYMBOL:	 ARGS:%v_3,
		 10: BRANCH %v_4[2.9,] 
BB 3
	outgoing: 5 
	datadep: 
	instructions:
		 0: topic->id def_%v_5 topic[2.5,] 	 SYMBOL:	 ARGS:
		 1: COPY TYPE_PASS def_topic %v_5[3.0,] 
		 2: 
BB 4
	outgoing: 5 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_5 
BB 5
	outgoing: 6 7 
	datadep: 
	instructions:
		 0: 
		 1: (User) def_%v_6 
		 2: user->is_a? def_%v_7 user[2.6,] %v_6[5.1,] 	 SYMBOL:	 ARGS:%v_6,
		 3: BRANCH %v_7[5.2,] 
BB 6
	outgoing: 8 
	datadep: 
	instructions:
		 0: user->id def_%v_8 user[2.6,] 	 SYMBOL:	 ARGS:
		 1: COPY TYPE_PASS def_user %v_8[6.0,] 
		 2: 
BB 7
	outgoing: 8 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_8 
BB 8
	outgoing: 9 
	datadep: 
	instructions:
		 0: 
		 1: (TopicUser) def_%v_9 
		 2: HASH-topic_id-user_id- def_%v_10 topic[3.1,2.5,] user[6.1,2.6,] 
		 3: %v_9->find_by def_%v_11 %v_9[8.1,] %v_10[8.2,] 	 SYMBOL:	 ARGS:%v_10,
		 4: RETURN %v_11[8.3,] %self[2.0,] 
BB 9
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = change instanceMethod = true
BB 1
	outgoing: 27 2 
	datadep: 
	instructions:
BB 2
	outgoing: 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_user_id 
		 6: RECEIVEARG def_topic_id 
		 7: RECEIVEARG def_attrs 
		 8: GLOBALVAR $! def_%v_3 
BB 4
	outgoing: 5 6 19 
	datadep: 
	instructions:
		 0: 
		 1: 
		 2: (inherit Topic) def_%v_6 
		 3: %v_6[4.2,] 
BB 5
	outgoing: 6 19 
	datadep: 
	instructions:
		 0: CONSTANT def_%v_6 	 SYMBOL:Topic,	 ARGS:Symbol,
BB 6
	outgoing: 7 8 19 
	datadep: 
	instructions:
		 0: topic_id->is_a? def_%v_7 topic_id[2.6,] %v_6[5.0,4.2,] 	 SYMBOL:	 ARGS:%v_6,
		 1: BRANCH %v_7[6.0,] 
BB 7
	outgoing: 9 19 
	datadep: 
	instructions:
		 0: topic_id->id def_%v_8 topic_id[2.6,] 	 SYMBOL:	 ARGS:
		 1: COPY TYPE_PASS def_topic_id %v_8[7.0,] 
		 2: 
BB 8
	outgoing: 9 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_8 
BB 9
	outgoing: 10 11 19 
	datadep: 
	instructions:
		 0: 
		 1: (inherit User) def_%v_9 
		 2: %v_9[9.1,] 
BB 10
	outgoing: 11 19 
	datadep: 
	instructions:
		 0: CONSTANT def_%v_9 	 SYMBOL:User,	 ARGS:Symbol,
BB 11
	outgoing: 12 13 19 
	datadep: 
	instructions:
		 0: user_id->is_a? def_%v_10 user_id[2.5,] %v_9[10.0,9.1,] 	 SYMBOL:	 ARGS:%v_9,
		 1: BRANCH %v_10[11.0,] 
BB 12
	outgoing: 14 19 
	datadep: 
	instructions:
		 0: user_id->id def_%v_11 user_id[2.5,] 	 SYMBOL:	 ARGS:
		 1: COPY TYPE_PASS def_user_id %v_11[12.0,] 
		 2: 
BB 13
	outgoing: 14 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_11 
BB 14
	outgoing: 15 16 19 
	datadep: 
	instructions:
		 0: 
		 1: topic_id->to_i def_%v_12 topic_id[7.1,2.6,] 	 SYMBOL:	 ARGS:
		 2: COPY TYPE_PASS def_topic_id %v_12[14.1,] 
		 3: 
		 4: user_id->to_i def_%v_13 user_id[12.1,2.5,] 	 SYMBOL:	 ARGS:
		 5: COPY TYPE_PASS def_user_id %v_13[14.4,] 
		 6: 
		 7: (TopicUser) def_%v_14 
		 8: %v_14->transaction def_%v_15 %v_14[14.7,] %self[2.0,] 	 SYMBOL:	 ARGS:%v_14,
CLOSURE BEGIN: attrs[2.7,] %self[2.0,] t[] attrs_array[] topic_id[14.1,14.2,] user_id[14.4,14.5,] attrs_sql[] vals[] auto_track_after[] now[] 
BB 1
	outgoing: 27 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%cl_1_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
BB 3
	outgoing: 4 9 25 
	datadep: 
	instructions:
		 0: 
		 1: attrs->dup def_%cl_1_3 attrs[] 	 SYMBOL:	 ARGS:
		 2: COPY TYPE_PASS def_attrs %cl_1_3[3.1,] 
		 3: 
		 4: %cl_1_3->[] def_%cl_1_4 %cl_1_3[3.1,] 	 SYMBOL:notification_level,	 ARGS:Symbol,
		 5: BRANCH %cl_1_4[3.4,] 
BB 4
	outgoing: 5 6 25 
	datadep: 
	instructions:
		 0: 
		 1: attrs->[] def_%cl_1_5 attrs[3.2,] 	 SYMBOL:notifications_changed_at,	 ARGS:Symbol,
		 2: BRANCH %cl_1_5[4.1,] 
BB 5
	outgoing: 6 25 
	datadep: 
	instructions:
		 0: (DateTime) def_%cl_1_6 
		 1: %cl_1_6->now def_%cl_1_7 %cl_1_6[5.0,] 	 SYMBOL:	 ARGS:
		 2: attrs->[]= def_%cl_1_5 attrs[3.2,] %cl_1_7[5.1,] 	 SYMBOL:notifications_changed_at,	 ARGS:Symbol,%cl_1_7,
		 3: COPY TYPE_PASS def_%cl_1_5 %cl_1_7[5.1,] 
BB 6
	outgoing: 7 8 25 
	datadep: 
	instructions:
		 0: 
		 1: attrs->[] def_%cl_1_8 attrs[5.2,3.2,] 	 SYMBOL:notifications_reason_id,	 ARGS:Symbol,
		 2: BRANCH %cl_1_8[6.1,] 
BB 7
	outgoing: 8 25 
	datadep: 
	instructions:
		 0: (TopicUser) def_%cl_1_9 
		 1: %cl_1_9->notification_reasons def_%cl_1_10 %cl_1_9[7.0,] 	 SYMBOL:	 ARGS:
		 2: %cl_1_10->[] def_%cl_1_11 %cl_1_10[7.1,] 	 SYMBOL:user_changed,	 ARGS:Symbol,
		 3: attrs->[]= def_%cl_1_8 attrs[5.2,3.2,] %cl_1_11[7.2,] 	 SYMBOL:notifications_reason_id,	 ARGS:Symbol,%cl_1_11,
		 4: COPY TYPE_PASS def_%cl_1_8 %cl_1_11[7.2,] 
BB 8
	outgoing: 10 
	datadep: 
	instructions:
		 0: 
BB 9
	outgoing: 10 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%cl_1_8 
BB 10
	outgoing: 11 23 25 
	datadep: 
	instructions:
		 0: 
		 1: attrs->to_a def_%cl_1_12 attrs[3.2,7.3,5.2,] 	 SYMBOL:	 ARGS:
		 2: COPY TYPE_PASS def_attrs_array %cl_1_12[10.1,] 
		 3: 
		 4: %cl_1_12->map def_%cl_1_13 %cl_1_12[10.1,] %self[2.0,] 	 SYMBOL:	 ARGS:%cl_1_12,
CLOSURE BEGIN: t[] 
BB 1
	outgoing: 6 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%cl_2_0 
		 2: RECEIVEARG def_t 
		 3: COPY TYPE_CurrentScope def_%current_scope 
		 4: COPY TYPE_ScopeModule def_%current_module 
BB 3
	outgoing: 4 6 
	datadep: 
	instructions:
		 0: 
		 1: t->[] def_%cl_2_3 t[2.2,] 	 SYMBOL:	 ARGS:Fixnum,
		 2: COPY TYPE_StringLiteral " = ?" def_%cl_2_4 
		 3: BUILDSTRING def_%cl_2_5 %cl_2_3[3.1,] %cl_2_4[3.2,] 
		 4: RETURN %cl_2_5[3.3,] %self[2.0,] 
BB 4
	outgoing: 6 
	datadep: 
	instructions:
		 0: def_%cl_2_6 
		 1: def_%cl_2_7 %cl_2_6[4.0,] 
		 2: RETURN %cl_2_7[4.1,] %self[2.0,] 
BB 6
	outgoing: 
	datadep: 
	instructions:
CLOSURE END: 
		 5: COPY TYPE_StringLiteral ", " def_%cl_1_14 
		 6: %cl_1_13->join def_%cl_1_15 %cl_1_13[10.4,] %cl_1_14[10.5,] 	 SYMBOL:	 ARGS:%cl_1_14,
		 7: COPY TYPE_PASS def_attrs_sql %cl_1_15[10.6,] 
		 8: 
		 9: attrs_array->map def_%cl_1_16 attrs_array[10.2,] %self[2.0,] 	 SYMBOL:	 ARGS:attrs_array,
CLOSURE BEGIN: t[10.4,] 
BB 1
	outgoing: 6 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%cl_3_0 
		 2: RECEIVEARG def_t 
		 3: COPY TYPE_CurrentScope def_%current_scope 
		 4: COPY TYPE_ScopeModule def_%current_module 
BB 3
	outgoing: 4 6 
	datadep: 
	instructions:
		 0: 
		 1: t->[] def_%cl_3_3 t[2.2,] 	 SYMBOL:	 ARGS:Fixnum,
		 2: RETURN %cl_3_3[3.1,] %self[2.0,] 
BB 4
	outgoing: 6 
	datadep: 
	instructions:
		 0: def_%cl_3_4 
		 1: def_%cl_3_5 %cl_3_4[4.0,] 
		 2: RETURN %cl_3_5[4.1,] %self[2.0,] 
BB 6
	outgoing: 
	datadep: 
	instructions:
CLOSURE END: 
		 10: COPY TYPE_PASS def_vals %cl_1_16[10.9,] 
		 11: 
		 12: (TopicUser) def_%cl_1_17 
		 13: HASH-topic_id-user_id- def_%cl_1_18 topic_id[] user_id[] 
		 14: %cl_1_17->where def_%cl_1_19 %cl_1_17[10.12,] %cl_1_18[10.13,] 	 SYMBOL:	 ARGS:%cl_1_18,
		 15: COPY TYPE_Array def_%cl_1_20 attrs_sql[10.7,] 
		 16: def_%cl_1_21 %cl_1_20[10.15,] vals[10.10,] 
		 17: %cl_1_19->update_all def_%cl_1_22 %cl_1_19[10.14,] %cl_1_21[10.16,] 	 SYMBOL:	 ARGS:%cl_1_21,
		 18: COPY TYPE_PASS def_rows %cl_1_22[10.17,] 
		 19: 
		 20: %cl_1_22->== def_%cl_1_23 %cl_1_22[10.17,] 	 SYMBOL:	 ARGS:Fixnum,
		 21: BRANCH %cl_1_23[10.20,] 
BB 11
	outgoing: 12 13 25 
	datadep: 
	instructions:
		 0: 
		 1: (DateTime) def_%cl_1_24 
		 2: %cl_1_24->now def_%cl_1_25 %cl_1_24[11.1,] 	 SYMBOL:	 ARGS:
		 3: COPY TYPE_PASS def_now %cl_1_25[11.2,] 
		 4: 
		 5: (UserOption) def_%cl_1_26 
		 6: HASH-user_id- def_%cl_1_27 user_id[] 
		 7: %cl_1_26->where def_%cl_1_28 %cl_1_26[11.5,] %cl_1_27[11.6,] 	 SYMBOL:	 ARGS:%cl_1_27,
		 8: %cl_1_28->pluck def_%cl_1_29 %cl_1_28[11.7,] 	 SYMBOL:auto_track_topics_after_msecs,	 ARGS:Symbol,
		 9: %cl_1_29->first def_%cl_1_30 %cl_1_29[11.8,] 	 SYMBOL:	 ARGS:
		 10: COPY TYPE_PASS def_auto_track_after %cl_1_30[11.9,] 
		 11: 
		 12: COPY TYPE_PASS def_%cl_1_31 %cl_1_30[11.9,] 
		 13: COPY TYPE_PASS def_%cl_1_32 %cl_1_30[11.9,] 
		 14: BRANCH %cl_1_30[11.9,] 
BB 12
	outgoing: 13 25 
	datadep: 
	instructions:
		 0: (SiteSetting) def_%cl_1_33 
		 1: %cl_1_33->default_other_auto_track_topics_after_msecs def_%cl_1_34 %cl_1_33[12.0,] 	 SYMBOL:	 ARGS:
		 2: COPY TYPE_PASS def_auto_track_after %cl_1_34[12.1,] 
		 3: COPY TYPE_PASS def_%cl_1_32 %cl_1_34[12.1,] 
BB 13
	outgoing: 14 17 25 
	datadep: 
	instructions:
		 0: 
		 1: auto_track_after->>= def_%cl_1_35 auto_track_after[12.2,11.10,] 	 SYMBOL:	 ARGS:Fixnum,
		 2: BRANCH %cl_1_35[13.1,] 
BB 14
	outgoing: 15 16 25 
	datadep: 
	instructions:
		 0: attrs->[] def_%cl_1_36 attrs[3.2,7.3,5.2,] 	 SYMBOL:total_msecs_viewed,	 ARGS:Symbol,
		 1: %cl_1_36->to_i def_%cl_1_37 %cl_1_36[14.0,] 	 SYMBOL:	 ARGS:
		 2: BRANCH %cl_1_37[14.1,] 
BB 15
	outgoing: 16 
	datadep: 
	instructions:
		 0: COPY TYPE_Fixnum def_%cl_1_37 
BB 16
	outgoing: 17 25 
	datadep: 
	instructions:
		 0: auto_track_after-><= def_%cl_1_38 auto_track_after[13.1,12.2,11.10,] %cl_1_37[15.0,14.1,] 	 SYMBOL:	 ARGS:%cl_1_37,
		 1: COPY TYPE_PASS def_%cl_1_35 %cl_1_38[16.0,] 
BB 17
	outgoing: 18 21 
	datadep: 
	instructions:
		 0: BRANCH %cl_1_35[16.1,13.1,] 
BB 18
	outgoing: 19 20 25 
	datadep: 
	instructions:
		 0: 
		 1: attrs->[] def_%cl_1_39 attrs[3.2,7.3,5.2,] 	 SYMBOL:notification_level,	 ARGS:Symbol,
		 2: BRANCH %cl_1_39[18.1,] 
BB 19
	outgoing: 20 25 
	datadep: 
	instructions:
		 0: %self->notification_levels def_%cl_1_40 %self[2.0,] 	 SYMBOL:	 ARGS:
		 1: %cl_1_40->[] def_%cl_1_41 %cl_1_40[19.0,] 	 SYMBOL:tracking,	 ARGS:Symbol,
		 2: attrs->[]= def_%cl_1_39 attrs[3.2,7.3,5.2,] %cl_1_41[19.1,] 	 SYMBOL:notification_level,	 ARGS:Symbol,%cl_1_41,
		 3: COPY TYPE_PASS def_%cl_1_39 %cl_1_41[19.1,] 
BB 20
	outgoing: 22 
	datadep: 
	instructions:
		 0: 
BB 21
	outgoing: 22 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%cl_1_39 
BB 22
	outgoing: 24 25 
	datadep: 
	instructions:
		 0: 
		 1: (TopicUser) def_%cl_1_42 
		 2: HASH-user_id-topic_id-first_visited_at-last_visited_at- def_%cl_1_43 user_id[] topic_id[] now[11.3,] now[11.3,] 
		 3: attrs->merge! def_%cl_1_44 attrs[19.2,3.2,7.3,5.2,] %cl_1_43[22.2,] 	 SYMBOL:	 ARGS:%cl_1_43,
		 4: %cl_1_42->create def_%cl_1_45 %cl_1_42[22.1,] %cl_1_44[22.3,] 	 SYMBOL:	 ARGS:%cl_1_44,
		 5: 
BB 23
	outgoing: 25 27 
	datadep: 
	instructions:
		 0: 
		 1: %self->observe_after_save_callbacks_for def_%cl_1_46 %self[2.0,] topic_id[] user_id[] 	 SYMBOL:	 ARGS:topic_id,user_id,
		 2: RETURN %cl_1_46[23.1,] %self[23.1,2.0,] 
BB 24
	outgoing: 27 
	datadep: 
	instructions:
		 0: RETURN %cl_1_45[22.4,] %self[2.0,] 
BB 25
	outgoing: 27 
	datadep: 
	instructions:
		 0: def_%cl_1_47 
		 1: def_%cl_1_48 %cl_1_47[25.0,] 
		 2: RETURN %cl_1_48[25.1,] %self[2.0,] 
BB 27
	outgoing: 
	datadep: 
	instructions:
CLOSURE END: attrs_sql[10.7,] vals[10.10,] auto_track_after[11.10,12.2,13.1,16.0,] now[11.3,] rows[10.18,] attrs[3.2,5.2,7.3,19.2,] 
		 9: 
		 10: attrs->[] def_%v_16 attrs[14.8,] 	 SYMBOL:notification_level,	 ARGS:Symbol,
		 11: BRANCH %v_16[14.10,] 
BB 15
	outgoing: 17 19 
	datadep: 
	instructions:
		 0: 
		 1: (MessageBus) def_%v_17 
		 2: COPY TYPE_StringLiteral "/topic/" def_%v_18 
		 3: BUILDSTRING def_%v_19 %v_18[15.2,] topic_id[14.2,] 
		 4: attrs->[] def_%v_20 attrs[14.8,] 	 SYMBOL:notification_level,	 ARGS:Symbol,
		 5: HASH-notification_level_change- def_%v_21 %v_20[15.4,] 
		 6: COPY TYPE_Array def_%v_22 user_id[14.5,] 
		 7: HASH-user_ids- def_%v_23 %v_22[15.6,] 
		 8: %v_17->publish def_%v_24 %v_17[15.1,] %v_19[15.3,] %v_21[15.5,] %v_23[15.7,] 	 SYMBOL:	 ARGS:%v_19,%v_21,%v_23,
		 9: 
BB 16
	outgoing: 17 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_24 
BB 17
	outgoing: 18 19 
	datadep: 
	instructions:
		 0: COPY TYPE_PASS def_%v_5 %v_24[16.0,15.8,] 
		 1: 
		 2: %v_3[2.8,] 
BB 18
	outgoing: 26 
	datadep: 
	instructions:
		 0: 
BB 19
	outgoing: 20 21 25 
	datadep: 
	instructions:
		 0: 
		 1: def_%v_25 
		 2: (ActiveRecord) def_%v_26 
		 3: (inherit RecordNotUnique) def_%v_27 %v_26[19.2,] 
		 4: %v_27[19.3,] 
BB 20
	outgoing: 21 25 
	datadep: 
	instructions:
		 0: %v_26->const_missing def_%v_27 %v_26[19.2,] 	 SYMBOL:RecordNotUnique,	 ARGS:Symbol,
BB 21
	outgoing: 22 23 25 
	datadep: 
	instructions:
		 0: def_%v_28 %v_27[20.0,19.3,] %v_25[19.1,] 
		 1: BRANCH %v_28[21.0,] 
BB 22
	outgoing: 25 27 
	datadep: 
	instructions:
		 0: %v_25[19.1,] 
BB 23
	outgoing: 24 25 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_5 
		 1: 
		 2: %v_3[2.8,] 
BB 24
	outgoing: 26 
	datadep: 
	instructions:
		 0: 
BB 25
	outgoing: 27 
	datadep: 
	instructions:
		 0: def_%v_29 
		 1: def_%v_30 %v_29[25.0,] %v_3[2.8,] 
		 2: %v_29[25.0,] 
BB 26
	outgoing: 27 
	datadep: 
	instructions:
		 0: RETURN %v_5[17.0,23.0,] %self[2.0,] 
BB 27
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = track_visit! instanceMethod = true
BB 1
	outgoing: 12 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_topic 
		 6: RECEIVEARG def_user 
		 7: 
		 8: (Topic) def_%v_3 
		 9: topic->is_a? def_%v_4 topic[2.5,] %v_3[2.8,] 	 SYMBOL:	 ARGS:%v_3,
		 10: BRANCH %v_4[2.9,] 
BB 3
	outgoing: 5 
	datadep: 
	instructions:
		 0: topic->id def_%v_5 topic[2.5,] 	 SYMBOL:	 ARGS:
		 1: 
BB 4
	outgoing: 5 
	datadep: 
	instructions:
		 0: COPY TYPE_PASS def_%v_5 topic[2.5,] 
BB 5
	outgoing: 6 7 
	datadep: 
	instructions:
		 0: COPY TYPE_PASS def_topic_id %v_5[4.0,3.0,] 
		 1: 
		 2: (User) def_%v_6 
		 3: user->is_a? def_%v_7 user[2.6,] %v_6[5.2,] 	 SYMBOL:	 ARGS:%v_6,
		 4: BRANCH %v_7[5.3,] 
BB 6
	outgoing: 8 
	datadep: 
	instructions:
		 0: user->id def_%v_8 user[2.6,] 	 SYMBOL:	 ARGS:
		 1: 
BB 7
	outgoing: 8 
	datadep: 
	instructions:
		 0: COPY TYPE_PASS def_%v_8 topic[2.5,] 
BB 8
	outgoing: 9 10 
	datadep: 
	instructions:
		 0: COPY TYPE_PASS def_user_id %v_8[7.0,6.0,] 
		 1: 
		 2: (DateTime) def_%v_9 
		 3: %v_9->now def_%v_10 %v_9[8.2,] 	 SYMBOL:	 ARGS:
		 4: COPY TYPE_PASS def_now %v_10[8.3,] 
		 5: 
		 6: (TopicUser) def_%v_11 
		 7: HASH-topic_id-user_id- def_%v_12 topic_id[5.0,] user_id[8.0,] 
		 8: %v_11->where def_%v_13 %v_11[8.6,] %v_12[8.7,] 	 SYMBOL:	 ARGS:%v_12,
		 9: HASH-last_visited_at- def_%v_14 now[8.4,] 
		 10: %v_13->update_all def_%v_15 %v_13[8.8,] %v_14[8.9,] 	 SYMBOL:	 ARGS:%v_14,
		 11: COPY TYPE_PASS def_rows %v_15[8.10,] 
		 12: 
		 13: %v_15->== def_%v_16 %v_15[8.10,] 	 SYMBOL:	 ARGS:Fixnum,
		 14: BRANCH %v_16[8.13,] 
BB 9
	outgoing: 12 
	datadep: 
	instructions:
		 0: 
		 1: (TopicUser) def_%v_17 
		 2: HASH-topic_id-user_id-last_visited_at-first_visited_at- def_%v_18 topic_id[5.0,] user_id[8.0,] now[8.4,] now[8.4,] 
		 3: %v_17->create def_%v_19 %v_17[9.1,] %v_18[9.2,] 	 SYMBOL:	 ARGS:%v_18,
		 4: RETURN %v_19[9.3,] %self[2.0,] 
BB 10
	outgoing: 12 
	datadep: 
	instructions:
		 0: 
		 1: %self->observe_after_save_callbacks_for def_%v_20 %self[2.0,] topic_id[5.0,] user_id[8.0,] 	 SYMBOL:	 ARGS:topic_id,user_id,
		 2: RETURN %v_20[10.1,] %self[10.1,2.0,] 
BB 12
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = update_last_read instanceMethod = true
BB 1
	outgoing: 28 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_user 
		 6: RECEIVEARG def_topic_id 
		 7: RECEIVEARG def_post_number 
		 8: RECEIVEARG def_msecs 
		 9: RECEIVECONSTARG def_opts 
		 10: opts[2.9,] 
BB 3
	outgoing: 4 
	datadep: 
	instructions:
		 0: HASH- def_%v_3 
		 1: COPY TYPE_PASS def_opts %v_3[3.0,] 
BB 4
	outgoing: 5 6 
	datadep: 
	instructions:
		 0: 
		 1: post_number->blank? def_%v_4 post_number[2.7,] 	 SYMBOL:	 ARGS:
		 2: BRANCH %v_4[4.1,] 
BB 5
	outgoing: 28 
	datadep: 
	instructions:
		 0: RETURN %self[2.0,] 
BB 6
	outgoing: 8 9 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_5 
		 1: 
		 2: msecs->to_i def_%v_6 msecs[2.8,] 	 SYMBOL:	 ARGS:
		 3: %v_6->< def_%v_7 %v_6[6.2,] 	 SYMBOL:	 ARGS:Fixnum,
		 4: BRANCH %v_7[6.3,] 
BB 8
	outgoing: 10 
	datadep: 
	instructions:
		 0: COPY TYPE_Fixnum def_msecs 
		 1: COPY TYPE_Fixnum def_%v_8 
		 2: 
BB 9
	outgoing: 10 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_8 
BB 10
	outgoing: 11 18 
	datadep: 
	instructions:
		 0: 
		 1: user->id def_%v_9 user[2.5,] 	 SYMBOL:	 ARGS:
		 2: (DateTime) def_%v_10 
		 3: %v_10->now def_%v_11 %v_10[10.2,] 	 SYMBOL:	 ARGS:
		 4: %self->notification_levels def_%v_12 %self[2.0,] 	 SYMBOL:	 ARGS:
		 5: %v_12->[] def_%v_13 %v_12[10.4,] 	 SYMBOL:tracking,	 ARGS:Symbol,
		 6: (SiteSetting) def_%v_14 
		 7: %v_14->default_other_auto_track_topics_after_msecs def_%v_15 %v_14[10.6,] 	 SYMBOL:	 ARGS:
		 8: HASH-user_id-topic_id-post_number-now-msecs-tracking-threshold- def_%v_16 %v_9[10.1,] topic_id[2.6,] post_number[2.7,] %v_11[10.3,] msecs[8.0,2.8,] %v_13[10.5,] %v_15[10.7,] 
		 9: COPY TYPE_PASS def_args %v_16[10.8,] 
		 10: 
		 11: (UPDATE_TOPIC_USER_SQL) def_%v_17 
		 12: %self->exec_sql def_%v_18 %self[10.4,2.0,] %v_17[10.11,] %v_16[10.8,] 	 SYMBOL:	 ARGS:%v_17,args,
		 13: %v_18->values def_%v_19 %v_18[10.12,] 	 SYMBOL:	 ARGS:
		 14: COPY TYPE_PASS def_rows %v_19[10.13,] 
		 15: 
		 16: %v_19->length def_%v_20 %v_19[10.13,] 	 SYMBOL:	 ARGS:
		 17: %v_20->== def_%v_21 %v_20[10.16,] 	 SYMBOL:	 ARGS:Fixnum,
		 18: BRANCH %v_21[10.17,] 
BB 11
	outgoing: 12 13 
	datadep: 
	instructions:
		 0: 
		 1: rows->[] def_%v_22 rows[10.14,] 	 SYMBOL:	 ARGS:Fixnum,
		 2: %v_22->[] def_%v_23 %v_22[11.1,] 	 SYMBOL:	 ARGS:Fixnum,
		 3: %v_23->to_i def_%v_24 %v_23[11.2,] 	 SYMBOL:	 ARGS:
		 4: COPY TYPE_PASS def_before %v_24[11.3,] 
		 5: 
		 6: rows->[] def_%v_25 rows[11.1,10.14,] 	 SYMBOL:	 ARGS:Fixnum,
		 7: %v_25->[] def_%v_26 %v_25[11.6,] 	 SYMBOL:	 ARGS:Fixnum,
		 8: %v_26->to_i def_%v_27 %v_26[11.7,] 	 SYMBOL:	 ARGS:
		 9: COPY TYPE_PASS def_after %v_27[11.8,] 
		 10: 
		 11: rows->[] def_%v_28 rows[11.1,11.6,10.14,] 	 SYMBOL:	 ARGS:Fixnum,
		 12: %v_28->[] def_%v_29 %v_28[11.11,] 	 SYMBOL:	 ARGS:Fixnum,
		 13: %v_29->to_i def_%v_30 %v_29[11.12,] 	 SYMBOL:	 ARGS:
		 14: COPY TYPE_PASS def_before_last_read %v_30[11.13,] 
		 15: 
		 16: %v_30->< def_%v_31 %v_30[11.13,] post_number[2.7,] 	 SYMBOL:	 ARGS:post_number,
		 17: BRANCH %v_31[11.16,] 
BB 12
	outgoing: 14 
	datadep: 
	instructions:
		 0: 
		 1: (TopicTrackingState) def_%v_32 
		 2: user->id def_%v_33 user[2.5,] 	 SYMBOL:	 ARGS:
		 3: %v_32->publish_read def_%v_34 %v_32[12.1,] topic_id[2.6,] post_number[2.7,] %v_33[12.2,] after[11.9,] 	 SYMBOL:	 ARGS:topic_id,post_number,%v_33,after,
		 4: 
		 5: post_number->- def_%v_35 post_number[2.7,] before_last_read[11.14,] 	 SYMBOL:	 ARGS:before_last_read,
		 6: opts->[] def_%v_36 opts[3.1,2.9,] 	 SYMBOL:mobile,	 ARGS:Symbol,
		 7: HASH-mobile- def_%v_37 %v_36[12.6,] 
		 8: user->update_posts_read! def_%v_38 user[12.2,2.5,] %v_35[12.5,] %v_37[12.7,] 	 SYMBOL:	 ARGS:%v_35,%v_37,
		 9: 
BB 13
	outgoing: 14 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_38 
BB 14
	outgoing: 15 16 
	datadep: 
	instructions:
		 0: 
		 1: before->!= def_%v_39 before[11.4,] after[11.9,] 	 SYMBOL:	 ARGS:after,
		 2: BRANCH %v_39[14.1,] 
BB 15
	outgoing: 17 
	datadep: 
	instructions:
		 0: 
		 1: (MessageBus) def_%v_40 
		 2: COPY TYPE_StringLiteral "/topic/" def_%v_41 
		 3: BUILDSTRING def_%v_42 %v_41[15.2,] topic_id[2.6,] 
		 4: HASH-notification_level_change- def_%v_43 after[11.9,] 
		 5: user->id def_%v_44 user[2.5,] 	 SYMBOL:	 ARGS:
		 6: COPY TYPE_Array def_%v_45 %v_44[15.5,] 
		 7: HASH-user_ids- def_%v_46 %v_45[15.6,] 
		 8: %v_40->publish def_%v_47 %v_40[15.1,] %v_42[15.3,] %v_43[15.4,] %v_46[15.7,] 	 SYMBOL:	 ARGS:%v_42,%v_43,%v_46,
		 9: 
BB 16
	outgoing: 17 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_47 
BB 17
	outgoing: 19 
	datadep: 
	instructions:
		 0: 
BB 18
	outgoing: 19 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_47 
BB 19
	outgoing: 20 26 
	datadep: 
	instructions:
		 0: 
		 1: rows->length def_%v_48 rows[10.14,] 	 SYMBOL:	 ARGS:
		 2: %v_48->== def_%v_49 %v_48[19.1,] 	 SYMBOL:	 ARGS:Fixnum,
		 3: BRANCH %v_49[19.2,] 
BB 20
	outgoing: 21 22 
	datadep: 
	instructions:
		 0: 
		 1: %self->notification_levels def_%v_50 %self[2.0,] 	 SYMBOL:	 ARGS:
		 2: %v_50->[] def_%v_51 %v_50[20.1,] 	 SYMBOL:regular,	 ARGS:Symbol,
		 3: ATTRASSIGN args->[] %v_51[20.2,] 
		 4: 
		 5: user->user_option def_%v_52 user[2.5,] 	 SYMBOL:	 ARGS:
		 6: %v_52->auto_track_topics_after_msecs def_%v_53 %v_52[20.5,] 	 SYMBOL:	 ARGS:
		 7: BRANCH %v_53[20.6,] 
BB 21
	outgoing: 22 
	datadep: 
	instructions:
		 0: (SiteSetting) def_%v_54 
		 1: %v_54->default_other_auto_track_topics_after_msecs def_%v_55 %v_54[21.0,] 	 SYMBOL:	 ARGS:
		 2: COPY TYPE_PASS def_%v_53 %v_55[21.1,] 
BB 22
	outgoing: 23 24 
	datadep: 
	instructions:
		 0: %v_53->== def_%v_56 %v_53[21.2,20.6,] 	 SYMBOL:	 ARGS:Fixnum,
		 1: BRANCH %v_56[22.0,] 
BB 23
	outgoing: 25 
	datadep: 
	instructions:
		 0: 
		 1: %self->notification_levels def_%v_57 %self[2.0,] 	 SYMBOL:	 ARGS:
		 2: %v_57->[] def_%v_58 %v_57[23.1,] 	 SYMBOL:tracking,	 ARGS:Symbol,
		 3: ATTRASSIGN args->[] %v_58[23.2,] 
		 4: 
BB 24
	outgoing: 25 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_58 
BB 25
	outgoing: 28 
	datadep: 
	instructions:
		 0: 
		 1: (TopicTrackingState) def_%v_59 
		 2: user->id def_%v_60 user[2.5,] 	 SYMBOL:	 ARGS:
		 3: args->[] def_%v_61 args[23.3,20.3,10.9,] 	 SYMBOL:new_status,	 ARGS:Symbol,
		 4: %v_59->publish_read def_%v_62 %v_59[25.1,] topic_id[2.6,] post_number[2.7,] %v_60[25.2,] %v_61[25.3,] 	 SYMBOL:	 ARGS:topic_id,post_number,%v_60,%v_61,
		 5: 
		 6: opts->[] def_%v_63 opts[3.1,2.9,] 	 SYMBOL:mobile,	 ARGS:Symbol,
		 7: HASH-mobile- def_%v_64 %v_63[25.6,] 
		 8: user->update_posts_read! def_%v_65 user[25.2,2.5,] post_number[2.7,] %v_64[25.7,] 	 SYMBOL:	 ARGS:post_number,%v_64,
		 9: 
		 10: COPY TYPE_StringLiteral "INSERT INTO topic_users (user_id, topic_id, last_read_post_number, highest_seen_post_number, last_visited_at, first_visited_at, notification_level)
                  SELECT :user_id, :topic_id, :post_number, ft.highest_post_number, :now, :now, :new_status
                  FROM topics AS ft
                  JOIN users u on u.id = :user_id
                  WHERE ft.id = :topic_id
                    AND NOT EXISTS(SELECT 1
                                   FROM topic_users AS ftu
                                   WHERE ftu.user_id = :user_id and ftu.topic_id = :topic_id)" def_%v_66 
		 11: %self->exec_sql def_%v_67 %self[2.0,] %v_66[25.10,] args[25.3,23.3,20.3,10.9,] 	 SYMBOL:	 ARGS:%v_66,args,
		 12: 
		 13: (MessageBus) def_%v_68 
		 14: COPY TYPE_StringLiteral "/topic/" def_%v_69 
		 15: BUILDSTRING def_%v_70 %v_69[25.14,] topic_id[2.6,] 
		 16: args->[] def_%v_71 args[25.3,23.3,20.3,10.9,] 	 SYMBOL:new_status,	 ARGS:Symbol,
		 17: HASH-notification_level_change- def_%v_72 %v_71[25.16,] 
		 18: user->id def_%v_73 user[25.2,25.8,2.5,] 	 SYMBOL:	 ARGS:
		 19: COPY TYPE_Array def_%v_74 %v_73[25.18,] 
		 20: HASH-user_ids- def_%v_75 %v_74[25.19,] 
		 21: %v_68->publish def_%v_76 %v_68[25.13,] %v_70[25.15,] %v_72[25.17,] %v_75[25.20,] 	 SYMBOL:	 ARGS:%v_70,%v_72,%v_75,
		 22: RETURN %v_76[25.21,] %self[25.11,2.0,] 
BB 26
	outgoing: 28 
	datadep: 
	instructions:
		 0: RETURN %self[2.0,] 
BB 28
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = observe_after_save_callbacks_for instanceMethod = true
BB 1
	outgoing: 3 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_topic_id 
		 6: RECEIVEARG def_user_id 
		 7: 
		 8: (TopicUser) def_%v_3 
		 9: HASH-topic_id-user_id- def_%v_4 topic_id[2.5,] user_id[2.6,] 
		 10: %v_3->where def_%v_5 %v_3[2.8,] %v_4[2.9,] 	 SYMBOL:	 ARGS:%v_4,
		 11: %v_5->each def_%v_6 %v_5[2.10,] %self[2.0,] 	 SYMBOL:	 ARGS:%v_5,
CLOSURE BEGIN: topic_user[] 
BB 1
	outgoing: 6 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%cl_1_0 
		 2: RECEIVEARG def_topic_user 
		 3: COPY TYPE_CurrentScope def_%current_scope 
		 4: COPY TYPE_ScopeModule def_%current_module 
BB 3
	outgoing: 4 6 
	datadep: 
	instructions:
		 0: 
		 1: (UserActionObserver) def_%cl_1_3 
		 2: %cl_1_3->instance def_%cl_1_4 %cl_1_3[3.1,] 	 SYMBOL:	 ARGS:
		 3: %cl_1_4->after_save def_%cl_1_5 %cl_1_4[3.2,] topic_user[2.2,] 	 SYMBOL:	 ARGS:topic_user,
		 4: RETURN %cl_1_5[3.3,] %self[2.0,] 
BB 4
	outgoing: 6 
	datadep: 
	instructions:
		 0: def_%cl_1_6 
		 1: def_%cl_1_7 %cl_1_6[4.0,] 
		 2: RETURN %cl_1_7[4.1,] %self[2.0,] 
BB 6
	outgoing: 
	datadep: 
	instructions:
CLOSURE END: 
		 12: RETURN %v_6[2.11,] %self[2.0,] 
BB 3
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = update_post_action_cache instanceMethod = false
BB 1
	outgoing: 28 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVECONSTARG def_opts 
		 6: opts[2.5,] 
BB 3
	outgoing: 4 
	datadep: 
	instructions:
		 0: HASH- def_%v_3 
		 1: COPY TYPE_PASS def_opts %v_3[3.0,] 
BB 4
	outgoing: 5 6 
	datadep: 
	instructions:
		 0: 
		 1: opts->[] def_%v_4 opts[3.1,2.5,] 	 SYMBOL:user_id,	 ARGS:Symbol,
		 2: COPY TYPE_PASS def_user_id %v_4[4.1,] 
		 3: 
		 4: opts->[] def_%v_5 opts[4.1,3.1,2.5,] 	 SYMBOL:post_id,	 ARGS:Symbol,
		 5: COPY TYPE_PASS def_post_id %v_5[4.4,] 
		 6: 
		 7: opts->[] def_%v_6 opts[4.1,4.4,3.1,2.5,] 	 SYMBOL:topic_id,	 ARGS:Symbol,
		 8: COPY TYPE_PASS def_topic_id %v_6[4.7,] 
		 9: 
		 10: opts->[] def_%v_7 opts[4.1,4.4,4.7,3.1,2.5,] 	 SYMBOL:post_action_type,	 ARGS:Symbol,
		 11: COPY TYPE_PASS def_action_type %v_7[4.10,] 
		 12: 
		 13: %v_7->== def_%v_8 %v_7[4.10,] 	 SYMBOL:like,	 ARGS:Symbol,
		 14: BRANCH %v_8[4.13,] 
BB 5
	outgoing: 7 
	datadep: 
	instructions:
		 0: COPY TYPE_StringLiteral "liked" def_%v_9 
		 1: COPY TYPE_PASS def_action_type_name %v_9[5.0,] 
		 2: 
BB 6
	outgoing: 7 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_9 
BB 7
	outgoing: 8 9 
	datadep: 
	instructions:
		 0: 
		 1: action_type->== def_%v_10 action_type[4.11,] 	 SYMBOL:bookmark,	 ARGS:Symbol,
		 2: BRANCH %v_10[7.1,] 
BB 8
	outgoing: 10 
	datadep: 
	instructions:
		 0: COPY TYPE_StringLiteral "bookmarked" def_%v_11 
		 1: COPY TYPE_PASS def_action_type_name %v_11[8.0,] 
		 2: 
BB 9
	outgoing: 10 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_11 
BB 10
	outgoing: 11 12 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_PASS def_%v_12 action_type[4.11,] 
		 2: BRANCH action_type[4.11,] 
BB 11
	outgoing: 12 
	datadep: 
	instructions:
		 0: action_type_name->! def_%v_13 action_type_name[8.1,5.1,] 	 SYMBOL:	 ARGS:
		 1: COPY TYPE_PASS def_%v_12 %v_13[11.0,] 
BB 12
	outgoing: 13 14 
	datadep: 
	instructions:
		 0: BRANCH %v_12[11.1,10.1,] 
BB 13
	outgoing: 15 
	datadep: 
	instructions:
		 0: (ArgumentError) def_%v_14 
		 1: COPY TYPE_StringLiteral "action_type" def_%v_15 
		 2: %self->raise def_%v_16 %self[2.0,] %v_14[13.0,] %v_15[13.1,] 	 SYMBOL:	 ARGS:%v_14,%v_15,
		 3: 
BB 14
	outgoing: 15 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_16 
BB 15
	outgoing: 16 17 
	datadep: 
	instructions:
		 0: 
		 1: BRANCH action_type_name[8.1,5.1,] 
BB 16
	outgoing: 19 20 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_17 
		 1: 
		 2: (SqlBuilder) def_%v_24 
		 3: COPY TYPE_StringLiteral "    UPDATE topic_users tu
    SET " def_%v_25 
		 4: 
		 5: COPY TYPE_StringLiteral " = x.state
    FROM (
      SELECT CASE WHEN EXISTS (
        SELECT 1
        FROM post_actions pa
        JOIN posts p on p.id = pa.post_id
        JOIN topics t ON t.id = p.topic_id
        WHERE pa.deleted_at IS NULL AND
              p.deleted_at IS NULL AND
              t.deleted_at IS NULL AND
              pa.post_action_type_id = :action_type_id AND
              tu2.topic_id = t.id AND
              tu2.user_id = pa.user_id
        LIMIT 1
      ) THEN true ELSE false END state, tu2.topic_id, tu2.user_id
      FROM topic_users tu2
      /*where*/
    ) x
    WHERE x.topic_id = tu.topic_id AND x.user_id = tu.user_id AND x.state != tu." def_%v_26 
		 6: 
		 7: COPY TYPE_StringLiteral "
" def_%v_27 
		 8: BUILDSTRING def_%v_28 %v_25[16.3,] action_type_name[8.1,5.1,] %v_26[16.5,] action_type_name[8.1,5.1,] %v_27[16.7,] 
		 9: %v_24->new def_%v_29 %v_24[16.2,] %v_28[16.8,] 	 SYMBOL:	 ARGS:%v_28,
		 10: COPY TYPE_PASS def_builder %v_29[16.9,] 
		 11: 
		 12: BRANCH user_id[4.2,] 
BB 17
	outgoing: 28 
	datadep: 
	instructions:
		 0: 
		 1: HASH-post_action_type- def_%v_18 
		 2: opts->merge def_%v_19 opts[3.1,2.5,] %v_18[17.1,] 	 SYMBOL:	 ARGS:%v_18,
		 3: %self->update_post_action_cache def_%v_20 %self[2.0,] %v_19[17.2,] 	 SYMBOL:	 ARGS:%v_19,
		 4: 
		 5: HASH-post_action_type- def_%v_21 
		 6: opts->merge def_%v_22 opts[17.2,3.1,2.5,] %v_21[17.5,] 	 SYMBOL:	 ARGS:%v_21,
		 7: %self->update_post_action_cache def_%v_23 %self[17.3,2.0,] %v_22[17.6,] 	 SYMBOL:	 ARGS:%v_22,
		 8: 
		 9: RETURN %self[17.3,17.7,2.0,] 
BB 19
	outgoing: 21 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_StringLiteral "tu2.user_id = :user_id" def_%v_30 
		 2: HASH-user_id- def_%v_31 user_id[4.2,] 
		 3: builder->where def_%v_32 builder[16.10,] %v_30[19.1,] %v_31[19.2,] 	 SYMBOL:	 ARGS:%v_30,%v_31,
		 4: 
BB 20
	outgoing: 21 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_32 
BB 21
	outgoing: 22 23 
	datadep: 
	instructions:
		 0: 
		 1: BRANCH topic_id[4.8,] 
BB 22
	outgoing: 24 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_StringLiteral "tu2.topic_id = :topic_id" def_%v_33 
		 2: HASH-topic_id- def_%v_34 topic_id[4.8,] 
		 3: builder->where def_%v_35 builder[16.10,] %v_33[22.1,] %v_34[22.2,] 	 SYMBOL:	 ARGS:%v_33,%v_34,
		 4: 
BB 23
	outgoing: 24 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_35 
BB 24
	outgoing: 25 26 
	datadep: 
	instructions:
		 0: 
		 1: BRANCH post_id[4.5,] 
BB 25
	outgoing: 27 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_StringLiteral "tu2.topic_id IN (SELECT topic_id FROM posts WHERE id = :post_id)" def_%v_36 
		 2: HASH-post_id- def_%v_37 post_id[4.5,] 
		 3: builder->where def_%v_38 builder[16.10,] %v_36[25.1,] %v_37[25.2,] 	 SYMBOL:	 ARGS:%v_36,%v_37,
		 4: 
		 5: COPY TYPE_StringLiteral "tu2.user_id IN (SELECT user_id FROM post_actions
                                     WHERE post_id = :post_id AND
                                           post_action_type_id = :action_type_id)" def_%v_39 
		 6: builder->where def_%v_40 builder[25.3,16.10,] %v_39[25.5,] 	 SYMBOL:	 ARGS:%v_39,
		 7: 
BB 26
	outgoing: 27 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_40 
BB 27
	outgoing: 28 
	datadep: 
	instructions:
		 0: 
		 1: (PostActionType) def_%v_41 
		 2: %v_41->types def_%v_42 %v_41[27.1,] 	 SYMBOL:	 ARGS:
		 3: %v_42->[] def_%v_43 %v_42[27.2,] action_type[4.11,] 	 SYMBOL:	 ARGS:action_type,
		 4: HASH-action_type_id- def_%v_44 %v_43[27.3,] 
		 5: builder->exec def_%v_45 builder[16.10,] %v_44[27.4,] 	 SYMBOL:	 ARGS:%v_44,
		 6: RETURN %v_45[27.5,] %self[2.0,] 
BB 28
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = cap_unread! instanceMethod = false
BB 1
	outgoing: 3 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVEARG def_user_id 
		 6: RECEIVEARG def_count 
		 7: 
		 8: COPY TYPE_StringLiteral "    UPDATE topic_users tu
    SET last_read_post_number = max_number,
        highest_seen_post_number = max_number
    FROM (
      SELECT MAX(post_number) max_number, p.topic_id FROM posts p
      WHERE deleted_at IS NULL
      GROUP BY p.topic_id
    ) m
    WHERE tu.user_id = :user_id AND
          m.topic_id = tu.topic_id AND
          tu.topic_id IN (
            " def_%v_3 
		 9: 
		 10: (TopicTrackingState) def_%v_4 
		 11: COPY TYPE_StringLiteral "topics.id" def_%v_5 
		 12: HASH-skip_new-select- def_%v_6 %v_5[2.11,] 
		 13: %v_4->report_raw_sql def_%v_7 %v_4[2.10,] %v_6[2.12,] 	 SYMBOL:	 ARGS:%v_6,
		 14: COPY TYPE_StringLiteral "
            offset :count
          )
" def_%v_8 
		 15: BUILDSTRING def_%v_9 %v_3[2.8,] %v_7[2.13,] %v_8[2.14,] 
		 16: COPY TYPE_PASS def_sql %v_9[2.15,] 
		 17: 
		 18: (TopicUser) def_%v_10 
		 19: HASH-user_id-count- def_%v_11 user_id[2.5,] count[2.6,] 
		 20: %v_10->exec_sql def_%v_12 %v_10[2.18,] %v_9[2.15,] %v_11[2.19,] 	 SYMBOL:	 ARGS:sql,%v_11,
		 21: RETURN %v_12[2.20,] %self[2.0,] 
BB 3
	outgoing: 
	datadep: 
	instructions:

SET IRMethod, name = ensure_consistency! instanceMethod = false
BB 1
	outgoing: 8 2 
	datadep: 
	instructions:
BB 2
	outgoing: 3 4 
	datadep: 
	instructions:
		 0: def_%self 
		 1: def_%v_0 
		 2: COPY TYPE_CurrentScope def_%current_scope 
		 3: COPY TYPE_ScopeModule def_%current_module 
		 4: 
		 5: RECEIVECONSTARG def_topic_id 
		 6: topic_id[2.5,] 
BB 3
	outgoing: 4 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_topic_id 
BB 4
	outgoing: 5 6 
	datadep: 
	instructions:
		 0: 
		 1: HASH-topic_id- def_%v_3 topic_id[3.0,2.5,] 
		 2: %self->update_post_action_cache def_%v_4 %self[2.0,] %v_3[4.1,] 	 SYMBOL:	 ARGS:%v_3,
		 3: 
		 4: (SqlBuilder) def_%v_5 
		 5: COPY TYPE_StringLiteral "
UPDATE topic_users t
  SET
    last_read_post_number = LEAST(GREATEST(last_read, last_read_post_number), max_post_number),
    highest_seen_post_number = LEAST(max_post_number,GREATEST(t.highest_seen_post_number, last_read))
FROM (
  SELECT topic_id, user_id, MAX(post_number) last_read
  FROM post_timings
  GROUP BY topic_id, user_id
) as X
JOIN (
  SELECT p.topic_id, MAX(p.post_number) max_post_number from posts p
  GROUP BY p.topic_id
) as Y on Y.topic_id = X.topic_id
/*where*/
" def_%v_6 
		 6: %v_5->new def_%v_7 %v_5[4.4,] %v_6[4.5,] 	 SYMBOL:	 ARGS:%v_6,
		 7: COPY TYPE_PASS def_builder %v_7[4.6,] 
		 8: 
		 9: COPY TYPE_StringLiteral "X.topic_id = t.topic_id AND
X.user_id = t.user_id AND
(
  last_read_post_number <> LEAST(GREATEST(last_read, last_read_post_number), max_post_number) OR
  highest_seen_post_number <> LEAST(max_post_number,GREATEST(t.highest_seen_post_number, last_read))
)
" def_%v_8 
		 10: %v_7->where def_%v_9 %v_7[4.6,] %v_8[4.9,] 	 SYMBOL:	 ARGS:%v_8,
		 11: 
		 12: BRANCH topic_id[3.0,2.5,] 
BB 5
	outgoing: 7 
	datadep: 
	instructions:
		 0: 
		 1: COPY TYPE_StringLiteral "t.topic_id = :topic_id" def_%v_10 
		 2: HASH-topic_id- def_%v_11 topic_id[3.0,2.5,] 
		 3: builder->where def_%v_12 builder[4.7,] %v_10[5.1,] %v_11[5.2,] 	 SYMBOL:	 ARGS:%v_10,%v_11,
		 4: 
BB 6
	outgoing: 7 
	datadep: 
	instructions:
		 0: COPY TYPE_Nil def_%v_12 
BB 7
	outgoing: 8 
	datadep: 
	instructions:
		 0: 
		 1: builder->exec def_%v_13 builder[4.7,] 	 SYMBOL:	 ARGS:
		 2: RETURN %v_13[7.1,] %self[2.0,] 
BB 8
	outgoing: 
	datadep: 
	instructions:

